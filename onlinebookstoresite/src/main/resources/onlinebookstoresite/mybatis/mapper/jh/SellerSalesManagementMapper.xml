<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jhta.mybatis.mapper.SellerSalesManagementMapper.jh">
	<!-- //*판매관리 관련 Mapper설정파일*// -->
	
	<resultMap type="obsalesjoin" id="obsalesjoin">
		<result column="bpaynum" property="bpaynum"/>
		<result column="snum" property="snum"/>
		<result column="btype" property="btype"/>
		<result column="bcount" property="bcount"/>
		<result column="baddr" property="baddr"/>
		<result column="phone" property="phone"/>
		<result column="bfinalmoney" property="bfinalmoney"/>
		<result column="borderdate" property="borderdate"/>
		<result column="bpaydate" property="bpaydate"/>
		<result column="bstatus" property="bstatus"/>
		<result column="ordermoney" property="ordermoney"/>
		<result column="mothodpayment" property="mothodpayment"/>
		<result column="receiver" property="receiver"/>
		<result column="mnum" property="mnum"/>
		<result column="delfee" property="delfee"/>
		<result column="mname" property="mname"/>
		<result column="obnum" property="obnum"/>
		<collection column="obnum" property="sellerOldbookVo"
			javaType="java.util.List" ofType="oldbooks" select="getSalesList"/>
	</resultMap>
	
	<select id="getOldbook" parameterType="int" resultType="oldbooks">
		select * from oldbooks where obnum=#{obnum}
	</select>
	<select id="getSalesList" parameterType="hashmap" resultType="obsalesjoin">
		select a.*,rownum rnum
		from(
            select DISTINCT b.bpaynum BPAYNUM, o.SNUM SNUM, p.BTYPE BTYPE, p.BCOUNT BCOUNT, 
            b.BADDR BADDR, b.BPHONE BPHONE, b.BFINALMONEY BFINALMONEY, b.BORDERDATE BORDERDATE, b.BPAYDATE BPAYDATE, 
            b.BSTATUS BSTATUS, b.ORDERMONEY ORDERMONEY, b.MOTHODPAYMENT MOTHODPAYMENT, b.RECEIVER RECEIVER, 
            b.MNUM MNUM, b.DELFEE DELFEE,m.mname MNAME
            from paymentbook p,bpayment b, oldbooks o,members m
            where b.bpaynum=p.bpaynum and p.btype=2 and p.bnum=o.obnum and b.mnum=m.mnum and snum=#{snum} and b.bstatus=#{bstatus}
            order by borderdate desc)a
	</select>
 
	<!-- 중고판매관리(1:입금대기중)
	<select id="getSalesList" parameterType="hashmap" resultType="obsalesjoin">
		select a.*,rownum rnum
		from(
            select DISTINCT b.bpaynum BPAYNUM, o.SNUM SNUM, p.BTYPE BTYPE, p.BCOUNT BCOUNT, 
            b.BADDR BADDR, b.BPHONE BPHONE, b.BFINALMONEY BFINALMONEY, b.BORDERDATE BORDERDATE, b.BPAYDATE BPAYDATE, 
            b.BSTATUS BSTATUS, b.ORDERMONEY ORDERMONEY, b.MOTHODPAYMENT MOTHODPAYMENT, b.RECEIVER RECEIVER, 
            b.MNUM MNUM, b.DELFEE DELFEE,m.mname MNAME
            from paymentbook p,bpayment b, oldbooks o,members m
            where b.bpaynum=p.bpaynum and p.btype=2 and p.bnum=o.obnum and b.mnum=m.mnum and snum=#{snum} and b.bstatus=#{bstatus}
            order by borderdate desc)a
	</select>
-->
</mapper>