<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.mapper.OrderManagerMapper">
	<!-- 주문상태일때 주문취소 (( 바로 취소시킴 )) -->
	<update id="orderCancel" parameterType="hashmap">
		update bpayment set 
		bstatus=
		<choose>
				<when test="bstatus==0">6</when>
				<otherwise>4</otherwise>
		</choose>
		where bpaynum=#{bpaynum}	
	</update>
	<!-- 전체취소시 새책수량복구를 위해 테이블에서 현재수량을 구해옴. -->
	<select id="commonCount" parameterType="hashmap" resultType="int">
		select bcount from books where bnum=#{bnum}
	</select>
	
	<update id="returnBookCount" parameterType="hashmap">
		update books set bcount=#{bcount} where bnum=#{bnum}
	</update>
	
	<!-- 주문에 해당하는 책들 리스트가져옴 -->
	<select id="getpaymentbook" parameterType="hashmap" resultType="BookVo">
		select bnum,bcount from paymentbook where btype=1 and bpaynum=#{bpaynum}
	</select>	
	
	
	
	<!-- 반품신청 -->
	<insert id="inputrefund" parameterType="hashmap">
		insert into refundhistory values(1,sysdate,null,
		<choose>
			<when test="apply=='cancel'">
				1
			</when>
			<when test="apply=='return'">
				2
			</when>
			<otherwise> <!-- 교환.. -->
				3
			</otherwise>
		</choose>
		,#{bnum},#{bcount})
	</insert>
</mapper>